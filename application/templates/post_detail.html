{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="mb-4">
    <h2>{{ post.title }}</h2>
    <p class="text-muted small">
        By {{ post.author.username }} ‚Ä¢
        {{ post.created_at.strftime('%d %b %Y') }}
        {% if post.category %}
            ‚Ä¢ {{ post.category.name }}
        {% endif %}
    </p>

    {% if post.tags %}
        <div class="mb-2">
            {% for tag in post.tags %}
                <span class="badge bg-secondary">{{ tag.name }}</span>
            {% endfor %}
        </div>
    {% endif %}

    <p class="mt-3">{{ post.content }}</p>

    <div class="d-flex gap-2 mt-4">
        {% if current_user.is_authenticated %}
            <form method="POST" action="{{ url_for('blog.like_post', post_id=post.id) }}">
                <button class="btn btn-outline-primary btn-sm">
                    üëç Like ({{ post.likes|length }})
                </button>
            </form>
        {% else %}
            <span class="text-muted">
                üëç Likes: {{ post.likes|length }}
            </span>
        {% endif %}

        {% if current_user.is_authenticated and
              (post.author_id == current_user.id or current_user.is_admin) %}
            <a href="{{ url_for('blog.edit_post', post_id=post.id) }}"
               class="btn btn-sm btn-warning">Edit</a>

            <form method="POST"
                  action="{{ url_for('blog.delete_post', post_id=post.id) }}"
                  onsubmit="return confirm('Delete this post?')">
                <button class="btn btn-sm btn-danger">Delete</button>
            </form>
        {% endif %}
    </div>
</div>

<hr>

<h5>Comments ({{ post.comments|length }})</h5>

{% for comment in post.comments %}
    <div class="border rounded p-2 mb-2">
        <strong>{{ comment.user.username }}</strong>
        <span class="text-muted small">
            {{ comment.created_at.strftime('%d %b %Y') }}
        </span>
        <p class="mb-0">{{ comment.content }}</p>
    </div>
{% else %}
    <p class="text-muted">No comments yet.</p>
{% endfor %}

{% if current_user.is_authenticated %}
    <form method="POST" class="mt-3">
        <div class="mb-3">
            <textarea name="content" class="form-control"
                      placeholder="Write a comment..." required></textarea>
        </div>
        <button class="btn btn-primary btn-sm">Add Comment</button>
    </form>
{% else %}
    <p class="text-muted mt-3">
        <a href="{{ url_for('authentication.login') }}">Login</a> to comment.
    </p>
{% endif %}
{% endblock %}
